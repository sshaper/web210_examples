<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>First Service Worker</title>
	<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<h1>Service Worker Test</h1>
	<output></output>
	<button onclick="update()">Update Check</button>
	<button onclick="unregister()">Unregister Service Worker</button>
	<script>
	function update(){
		navigator.serviceWorker.getRegistration()
		.then(registration => {
			registration.update();
		});
	}

	function unregister(){
		navigator.serviceWorker.getRegistration()
		.then(registration => {
			registration.unregister();
		});
	}
	
	if('serviceWorker' in navigator){
		navigator.serviceWorker.register("./service_worker.js", {scope: "./"})
		.then( registration => {
			const scope = registration.scope;
			document.querySelector("output").innerHTML = `Service Worker registered properly at ${scope}`;
		})
		.catch( error => {
			document.querySelector("output").innerHTML = "Service Worker not Registered";
		})
	}
	else {
		document.querySelector("output").innerHTML = "Service Worker Not available";
	}

	if('serviceWorker' in navigator){
		navigator.serviceWorker.getRegistration()
		.then( registration =>{
			registration.addEventListener('updatefound', event =>{
				const swInstalling = registration.installing;
				swInstalling.addEventListener("statechange", () => {
					if(swInstalling.state == 'installed'){
						document.querySelector('output').innerHTML = "A new service worker is installed and waiting";
					}
					else {
						document.querySelector('output').innerHTML = "A new service worker is now controlling the page";
					}
				});
			});
		})
		.catch( error =>{

		})
	}
	</script>
</body>
</html>